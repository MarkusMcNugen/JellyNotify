{
  "embeds": [
    {
      "title": "⬆️ {{ item.item_type }} {% if changes|length == 1 %}{{ changes[0].type|title }} {% endif %}Upgraded",
      "description": "{% if item.item_type == 'Episode' %}**{{ item.series_name }}** S{{ '%02d'|format(item.season_number or 0) }}E{{ '%02d'|format(item.episode_number or 0) }}\n{{ item.name }}{% if item.air_time %}\n*Originally aired: {{ item.air_time }}*{% endif %}{% elif item.item_type == 'Audio' %}{% if item.album %}**{{ item.album }}**{% if item.album_artist %} by {{ item.album_artist }}{% endif %}\n{% endif %}{{ item.name }}{% if item.artists and item.artists|length > 0 %} by {{ item.artists|join(', ') }}{% endif %}{% elif item.item_type == 'Photo' %}**{{ item.name }}**{% if item.width and item.height %}\n{{ item.width }}×{{ item.height }} pixels{% endif %}{% else %}**{{ item.name }}**{% if item.year %} ({{ item.year }}){% endif %}{% if item.tagline %}\n*{{ item.tagline }}*{% endif %}{% endif %}{% if item.overview and item.overview|length > 0 %}\n\n*{{ (item.overview[:200] + '...') if item.overview|length > 200 else item.overview }}*{% endif %}",
      "color": {{ color }},
      {% if item.item_type == 'Episode' and item.series_id %}
      "author": {
        "name": "{{ item.series_name }}{% if item.series_premiere_date %} ({{ item.series_premiere_date[:4] }}){% endif %}",
        "icon_url": "{{ jellyfin_url }}/Items/{{ item.series_id }}/Images/Logo?api_key={{ api_key }}&maxHeight=64&maxWidth=200",
        "url": "{{ jellyfin_url }}/web/index.html#!/details?id={{ item.series_id }}"
      },
      {% endif %}
      "fields": [
        {# Upgrade Summary (non-inline for emphasis) #}
        {
          "name": "🔄 Upgrade Summary",
          "value": "{% for change in changes[:8] %}**{% if change.type == 'resolution' %}📐 Resolution:{% elif change.type == 'codec' %}🎞️ Video Codec:{% elif change.type == 'audio_codec' %}🔊 Audio Codec:{% elif change.type == 'audio_channels' %}🔊 Audio Channels:{% elif change.type == 'hdr_status' %}🌈 HDR Status:{% elif change.type == 'file_size' %}💾 File:{% elif change.type == 'provider_ids' %}🔗 Metadata:{% elif change.type == 'bitrate' %}📊 Bitrate:{% elif change.type == 'framerate' %}🎬 Frame Rate:{% elif change.type == 'audio_language' %}🌐 Audio Language:{% elif change.type == 'subtitle_language' %}📝 Subtitles:{% else %}🔄 {{ change.type|title }}:{% endif %}** {% if change.type == 'resolution' %}{{ change.old_value or 'Unknown' }}p → **{{ change.new_value or 'Unknown' }}p**{% elif change.type in ['codec', 'audio_codec'] %}{{ change.old_value or 'Unknown' }} → **{{ change.new_value or 'Unknown' }}**{% elif change.type == 'audio_channels' %}{{ change.old_value or 0 }} ch → **{{ change.new_value or 0 }} ch**{% elif change.type == 'hdr_status' %}{{ change.old_value or 'SDR' }} → **{{ change.new_value or 'SDR' }}**{% elif change.type == 'file_size' %}File replaced{% if item.file_size %} ({{ '%.1f'|format(item.file_size / 1073741824) }}GB){% endif %}{% elif change.type == 'provider_ids' %}External IDs updated{% elif change.type == 'bitrate' %}{{ '%.1f'|format((change.old_value or 0) / 1000000) }}Mbps → **{{ '%.1f'|format((change.new_value or 0) / 1000000) }}Mbps**{% elif change.type == 'framerate' %}{{ change.old_value or 0 }}fps → **{{ change.new_value or 0 }}fps**{% elif change.type in ['audio_language', 'subtitle_language'] %}{{ change.old_value or 'Unknown' }} → **{{ change.new_value or 'Unknown' }}**{% else %}{{ change.description or 'Updated' }}{% endif %}{% if not loop.last %}\n{% endif %}{% endfor %}{% if changes|length > 8 %}\n*...and {{ changes|length - 8 }} more changes*{% endif %}",
          "inline": false
        },

        {# Current Content Metadata (inline for quick overview) #}
        {% if item.genres and item.genres|length > 0 %}
        {
          "name": "🎭 Genres",
          "value": "{{ item.genres[:4]|join(', ') }}{% if item.genres|length > 4 %} +{{ item.genres|length - 4 }} more{% endif %}",
          "inline": true
        },
        {% endif %}
        {% if item.official_rating %}
        {
          "name": "🛡️ Rating",
          "value": "{{ item.official_rating }}",
          "inline": true
        },
        {% endif %}
        {% if item.studios and item.studios|length > 0 %}
        {
          "name": "🏢 Studio",
          "value": "{{ item.studios[0] }}{% if item.studios|length > 1 %} +{{ item.studios|length - 1 }} more{% endif %}",
          "inline": true
        },
        {% endif %}

        {# Current Technical Specifications (inline for quick overview) #}
        {% if item.video_height and item.item_type not in ['Audio', 'MusicAlbum', 'MusicArtist', 'Photo'] %}
        {
          "name": "📐 Current Quality",
          "value": "{{ item.video_height }}p{% if item.video_range and item.video_range != 'SDR' %} {{ item.video_range }}{% endif %}{% if item.video_width %} ({{ item.video_width }}×{{ item.video_height }}){% endif %}",
          "inline": true
        },
        {% endif %}
        {% if item.video_codec and item.item_type not in ['Audio', 'MusicAlbum', 'MusicArtist', 'Photo'] %}
        {
          "name": "🎞️ Current Video",
          "value": "{{ item.video_codec.upper() }}{% if item.video_profile %} {{ item.video_profile }}{% endif %}{% if item.video_framerate %} @ {{ item.video_framerate }}fps{% endif %}",
          "inline": true
        },
        {% endif %}
        {% if item.audio_codec %}
        {
          "name": "🔊 Current Audio",
          "value": "{{ item.audio_codec.upper() }}{% if item.audio_channels %} {{ item.audio_channels }}.{% if item.audio_channels > 2 %}1{% else %}0{% endif %}{% endif %}{% if item.audio_language %} ({{ item.audio_language }}){% endif %}",
          "inline": true
        },
        {% endif %}

        {# Current Comprehensive Video Technical Details (non-inline) #}
        {% if item.item_type not in ['Audio', 'MusicAlbum', 'MusicArtist', 'Photo'] and (item.video_codec or item.video_height or item.aspect_ratio or item.video_bitrate or item.video_bitdepth) %}
        {
          "name": "🎥 Current Video Specifications",
          "value": "{% if item.video_height %}**Resolution:** {{ item.video_height }}p{% if item.video_width %} ({{ item.video_width }}×{{ item.video_height }}){% endif %}{% endif %}{% if item.video_codec %}\n**Codec:** {{ item.video_codec.upper() }}{% if item.video_profile %} ({{ item.video_profile }}){% endif %}{% if item.video_level %} Level {{ item.video_level }}{% endif %}{% endif %}{% if item.video_range and item.video_range != 'SDR' %}\n**HDR:** {{ item.video_range }}{% endif %}{% if item.video_bitdepth and item.video_bitdepth > 8 %}\n**Bit Depth:** {{ item.video_bitdepth }}-bit{% endif %}{% if item.video_framerate %}\n**Frame Rate:** {{ item.video_framerate }}fps{% if item.video_interlaced %} (Interlaced){% endif %}{% endif %}{% if item.aspect_ratio %}\n**Aspect Ratio:** {{ item.aspect_ratio }}{% endif %}{% if item.video_bitrate %}\n**Bitrate:** {{ '%.1f'|format(item.video_bitrate / 1000000) }} Mbps{% endif %}{% if item.video_refframes %}\n**Reference Frames:** {{ item.video_refframes }}{% endif %}{% if item.video_colorspace %}\n**Color Space:** {{ item.video_colorspace }}{% endif %}{% if item.video_colortransfer %}\n**Color Transfer:** {{ item.video_colortransfer }}{% endif %}{% if item.video_colorprimaries %}\n**Color Primaries:** {{ item.video_colorprimaries }}{% endif %}{% if item.video_pixelformat %}\n**Pixel Format:** {{ item.video_pixelformat }}{% endif %}{% if item.video_title %}\n**Stream Title:** {{ item.video_title }}{% endif %}",
          "inline": false
        },
        {% endif %}

        {# Current Comprehensive Audio Technical Details (non-inline) #}
        {% if item.audio_codec or item.audio_channels or item.audio_bitrate or item.audio_samplerate %}
        {
          "name": "🔊 Current Audio Specifications",
          "value": "{% if item.audio_codec %}**Codec:** {{ item.audio_codec.upper() }}{% endif %}{% if item.audio_channels %}\n**Channels:** {{ item.audio_channels }}.{% if item.audio_channels > 2 %}1{% else %}0{% endif %}{% endif %}{% if item.audio_samplerate %}\n**Sample Rate:** {{ item.audio_samplerate }}Hz{% endif %}{% if item.audio_bitrate %}\n**Bitrate:** {{ '%.0f'|format(item.audio_bitrate / 1000) }} kbps{% endif %}{% if item.audio_language %}\n**Language:** {{ item.audio_language.upper() }}{% endif %}{% if item.audio_default %}\n**Default Track:** Yes{% endif %}{% if item.audio_title %}\n**Stream Title:** {{ item.audio_title }}{% endif %}",
          "inline": false
        },
        {% endif %}

        {# Current Subtitle Information #}
        {% if item.subtitle_language or item.subtitle_codec %}
        {
          "name": "📝 Current Subtitle Information",
          "value": "{% if item.subtitle_language %}**Language:** {{ item.subtitle_language.upper() }}{% endif %}{% if item.subtitle_codec %}\n**Format:** {{ item.subtitle_codec.upper() }}{% endif %}{% if item.subtitle_external %}{% if item.subtitle_external %}\n**Type:** External File{% else %}\n**Type:** Embedded{% endif %}{% endif %}{% if item.subtitle_forced %}\n**Forced:** Yes{% endif %}{% if item.subtitle_default %}\n**Default:** Yes{% endif %}{% if item.subtitle_title %}\n**Stream Title:** {{ item.subtitle_title }}{% endif %}",
          "inline": true
        },
        {% endif %}

        {# Music-specific Information #}
        {% if item.item_type in ['Audio', 'MusicAlbum', 'MusicArtist'] %}
        {
          "name": "🎵 Current Music Information",
          "value": "{% if item.album %}**Album:** {{ item.album }}{% endif %}{% if item.album_artist %}\n**Album Artist:** {{ item.album_artist }}{% endif %}{% if item.artists and item.artists|length > 0 %}\n**Artists:** {{ item.artists|join(', ') }}{% endif %}{% if item.runtime_ticks %}\n**Duration:** {{ ((item.runtime_ticks / 10000000) / 60) | round(1) }} minutes{% endif %}",
          "inline": false
        },
        {% endif %}

        {# Photo-specific Information #}
        {% if item.item_type == 'Photo' and (item.width or item.height) %}
        {
          "name": "📷 Current Photo Information",
          "value": "{% if item.width and item.height %}**Dimensions:** {{ item.width }}×{{ item.height }}{% endif %}{% if item.file_size %}\n**File Size:** {{ '%.2f'|format(item.file_size / 1048576) }} MB{% endif %}",
          "inline": false
        },
        {% endif %}

        {# Current File Information #}
        {% if item.file_size or item.runtime_ticks or item.date_modified %}
        {
          "name": "💾 Current File Information",
          "value": "{% if item.file_size %}**Size:** {{ '%.2f'|format(item.file_size / 1073741824) }} GB{% endif %}{% if item.runtime_ticks and item.item_type not in ['Audio', 'Photo'] %}\n**Duration:** {% set hours = (item.runtime_ticks / 36000000000) | int %}{% set minutes = ((item.runtime_ticks / 600000000) % 60) | int %}{{ hours }}h {{ minutes }}m{% endif %}{% if item.library_name %}\n**Library:** {{ item.library_name }}{% endif %}{% if item.file_path %}\n**Path:** {{ item.file_path|truncate(50) }}{% endif %}{% if item.date_modified %}\n**Last Modified:** {{ item.date_modified[:10] }}{% endif %}",
          "inline": true
        },
        {% endif %}

        {# External References #}
        {% if item.imdb_id or item.tmdb_id or item.tvdb_id %}
        {
          "name": "🔗 External Links",
          "value": "{% if item.imdb_id %}**IMDb:** [{{ item.imdb_id }}](https://www.imdb.com/title/{{ item.imdb_id }}/){% endif %}{% if item.tmdb_id %}{% if item.imdb_id %}\n{% endif %}**TMDB:** [{{ item.tmdb_id }}](https://www.themoviedb.org/{% if item.item_type == 'Movie' %}movie{% else %}tv{% endif %}/{{ item.tmdb_id }}){% endif %}{% if item.tvdb_id %}{% if item.imdb_id or item.tmdb_id %}\n{% endif %}**TVDB:** [{{ item.tvdb_id }}](https://thetvdb.com/dereferrer/series/{{ item.tvdb_id }}){% endif %}",
          "inline": true
        },
        {% endif %}

        {# Server Information #}
        {% if item.server_name or item.server_version %}
        {
          "name": "🖥️ Server Information",
          "value": "{% if item.server_name %}**Server:** {{ item.server_name }}{% endif %}{% if item.server_version %}\n**Version:** {{ item.server_version }}{% endif %}{% if item.server_url %}\n**URL:** {{ item.server_url }}{% endif %}",
          "inline": true
        },
        {% endif %}

        {# Tags and Additional Metadata #}
        {% if item.tags and item.tags|length > 0 %}
        {
          "name": "🏷️ Tags",
          "value": "{{ item.tags[:6]|join(', ') }}{% if item.tags|length > 6 %} +{{ item.tags|length - 6 }} more{% endif %}",
          "inline": false
        },
        {% endif %}

        {# Timestamps and History #}
        {% if item.premiere_date or item.date_created or item.timestamp %}
        {
          "name": "📅 Timeline",
          "value": "{% if item.premiere_date %}**Premiered:** {{ item.premiere_date[:10] }}{% endif %}{% if item.date_created %}{% if item.premiere_date %}\n{% endif %}**Originally Added:** {{ item.date_created[:10] }}{% endif %}{% if item.timestamp %}{% if item.premiere_date or item.date_created %}\n{% endif %}**Upgraded:** {{ item.timestamp[:19] | replace('T', ' ') }} UTC{% endif %}",
          "inline": true
        }
        {% endif %}
      ],
      "thumbnail": {
        "url": "{{ jellyfin_url }}/Items/{{ item.item_id }}/Images/Primary?api_key={{ api_key }}&maxHeight=300&maxWidth=200"
      },
      "footer": {
        "text": "Upgraded on {% if item.server_name %}{{ item.server_name }}{% else %}Jellyfin{% endif %}{% if item.library_name %} • {{ item.library_name }}{% endif %}",
        "icon_url": "{{ jellyfin_url }}/web/favicon.ico"
      },
      "timestamp": "{{ timestamp }}",
      "url": "{% if item.imdb_id %}https://www.imdb.com/title/{{ item.imdb_id }}/{% elif item.tmdb_id %}https://www.themoviedb.org/{% if item.item_type == 'Movie' %}movie{% else %}tv{% endif %}/{{ item.tmdb_id }}{% elif item.tvdb_id %}https://thetvdb.com/dereferrer/series/{{ item.tvdb_id }}{% else %}{{ jellyfin_url }}/web/index.html#!/details?id={{ item.item_id }}{% endif %}"
    }
  ]
}