{
  "embeds": [
    {
      "title": "🔄 Jellyfin Library Updates ({{ total_items }})",
      "description": "The following items have been added or upgraded in Jellyfin:",
      "color": 3447003,
      "fields": [
        {% if 'movies' in categories %}
        {
          "name": "🎬 Movies",
          "value": "{% if categories.movies.new|length > 0 %}**New ({{ categories.movies.new|length }})**: {% for item_data in categories.movies.new[:3] %}{{ item_data.item.name }}{% if item_data.item.year %} ({{ item_data.item.year }}){% endif %}{% if not loop.last %}, {% endif %}{% endfor %}{% if categories.movies.new|length > 3 %}, +{{ categories.movies.new|length - 3 }} more{% endif %}{% endif %}{% if categories.movies.new|length > 0 and categories.movies.upgraded|length > 0 %}\n{% endif %}{% if categories.movies.upgraded|length > 0 %}**Upgraded ({{ categories.movies.upgraded|length }})**: {% for item_data in categories.movies.upgraded[:3] %}{{ item_data.item.name }}{% if item_data.item.year %} ({{ item_data.item.year }}){% endif %}{% if not loop.last %}, {% endif %}{% endfor %}{% if categories.movies.upgraded|length > 3 %}, +{{ categories.movies.upgraded|length - 3 }} more{% endif %}{% endif %}",
          "inline": false
        }{% if 'tv' in categories or 'music' in categories or 'other' in categories %},{% endif %}
        {% endif %}
        {% if 'tv' in categories %}
        {
          "name": "📺 TV Shows",
          "value": "{% if categories.tv.new|length > 0 %}**New Episodes ({{ categories.tv.new|length }})**: {% for item_data in categories.tv.new[:4] %}{{ item_data.item.series_name }} S{{ '%02d'|format(item_data.item.season_number or 0) }}E{{ '%02d'|format(item_data.item.episode_number or 0) }}{% if not loop.last %}, {% endif %}{% endfor %}{% if categories.tv.new|length > 4 %}, +{{ categories.tv.new|length - 4 }} more{% endif %}{% endif %}{% if categories.tv.new|length > 0 and categories.tv.upgraded|length > 0 %}\n{% endif %}{% if categories.tv.upgraded|length > 0 %}**Upgraded Episodes ({{ categories.tv.upgraded|length }})**: {% for item_data in categories.tv.upgraded[:4] %}{{ item_data.item.series_name }} S{{ '%02d'|format(item_data.item.season_number or 0) }}E{{ '%02d'|format(item_data.item.episode_number or 0) }}{% if not loop.last %}, {% endif %}{% endfor %}{% if categories.tv.upgraded|length > 4 %}, +{{ categories.tv.upgraded|length - 4 }} more{% endif %}{% endif %}",
          "inline": false
        }{% if 'music' in categories or 'other' in categories %},{% endif %}
        {% endif %}
        {% if 'music' in categories %}
        {
          "name": "🎵 Music",
          "value": "{% if categories.music.new|length > 0 %}**New Tracks ({{ categories.music.new|length }})**: {% for item_data in categories.music.new[:5] %}{{ item_data.item.name }}{% if not loop.last %}, {% endif %}{% endfor %}{% if categories.music.new|length > 5 %}, +{{ categories.music.new|length - 5 }} more{% endif %}{% endif %}{% if categories.music.new|length > 0 and categories.music.upgraded|length > 0 %}\n{% endif %}{% if categories.music.upgraded|length > 0 %}**Upgraded Tracks ({{ categories.music.upgraded|length }})**: {% for item_data in categories.music.upgraded[:5] %}{{ item_data.item.name }}{% if not loop.last %}, {% endif %}{% endfor %}{% if categories.music.upgraded|length > 5 %}, +{{ categories.music.upgraded|length - 5 }} more{% endif %}{% endif %}",
          "inline": false
        }{% if 'other' in categories %},{% endif %}
        {% endif %}
        {% if 'other' in categories %}
        {
          "name": "📁 Other Content",
          "value": "{% if categories.other.new|length > 0 %}**New Items ({{ categories.other.new|length }})**: {% for item_data in categories.other.new[:4] %}{{ item_data.item.name }}{% if not loop.last %}, {% endif %}{% endfor %}{% if categories.other.new|length > 4 %}, +{{ categories.other.new|length - 4 }} more{% endif %}{% endif %}{% if categories.other.new|length > 0 and categories.other.upgraded|length > 0 %}\n{% endif %}{% if categories.other.upgraded|length > 0 %}**Upgraded Items ({{ categories.other.upgraded|length }})**: {% for item_data in categories.other.upgraded[:4] %}{{ item_data.item.name }}{% if not loop.last %}, {% endif %}{% endfor %}{% if categories.other.upgraded|length > 4 %}, +{{ categories.other.upgraded|length - 4 }} more{% endif %}{% endif %}",
          "inline": false
        }
        {% endif %}
      ]{% set first_movie = categories.movies.new|first if 'movies' in categories and categories.movies.new|length > 0 else categories.movies.upgraded|first if 'movies' in categories and categories.movies.upgraded|length > 0 else none %}{% set first_series_or_episode = categories.tv.new|selectattr('item.item_type', 'equalto', 'Series')|first if 'tv' in categories and categories.tv.new|length > 0 else categories.tv.new|first if 'tv' in categories and categories.tv.new|length > 0 else categories.tv.upgraded|selectattr('item.item_type', 'equalto', 'Series')|first if 'tv' in categories and categories.tv.upgraded|length > 0 else categories.tv.upgraded|first if 'tv' in categories and categories.tv.upgraded|length > 0 else none %}{% set first_music = categories.music.new|first if 'music' in categories and categories.music.new|length > 0 else categories.music.upgraded|first if 'music' in categories and categories.music.upgraded|length > 0 else none %}{% set first_other = categories.other.new|first if 'other' in categories and categories.other.new|length > 0 else categories.other.upgraded|first if 'other' in categories and categories.other.upgraded|length > 0 else none %}{% if first_movie or first_series_or_episode or first_music or first_other %},
      "thumbnail": {
        "url": "{% if first_movie %}{{ jellyfin_url }}/Items/{{ first_movie.item.item_id }}/Images/Primary?maxHeight=400&maxWidth=300{% elif first_series_or_episode and first_series_or_episode.item.item_type == 'Series' %}{{ jellyfin_url }}/Items/{{ first_series_or_episode.item.item_id }}/Images/Primary?maxHeight=400&maxWidth=300{% elif first_series_or_episode and first_series_or_episode.item.series_id %}{{ jellyfin_url }}/Items/{{ first_series_or_episode.item.series_id }}/Images/Primary?maxHeight=400&maxWidth=300{% elif first_music %}{{ jellyfin_url }}/Items/{{ first_music.item.item_id }}/Images/Primary?maxHeight=400&maxWidth=300{% elif first_other %}{{ jellyfin_url }}/Items/{{ first_other.item.item_id }}/Images/Primary?maxHeight=400&maxWidth=300{% else %}{{ jellyfin_url }}/web/assets/img/banner-light.png{% endif %}"
      }{% endif %}{% if first_movie %},
      "image": {
        "url": "{{ jellyfin_url }}/Items/{{ first_movie.item.item_id }}/Images/Primary?maxHeight=400&maxWidth=300"
      }{% elif first_series_or_episode and first_series_or_episode.item.item_type == 'Series' %},
      "image": {
        "url": "{{ jellyfin_url }}/Items/{{ first_series_or_episode.item.item_id }}/Images/Primary?maxHeight=400&maxWidth=300"
      }{% endif %},
      "footer": {
        "text": "Jellyfin Library Updates • {{ timestamp[:19] | replace('T', ' ') }} UTC{% if tvdb_attribution_needed %}\nMetadata provided by TheTVDB{% endif %}",
        "icon_url": "{{ jellyfin_url }}/web/favicon.ico"
      },
      "timestamp": "{{ timestamp }}"
    }
  ]
}