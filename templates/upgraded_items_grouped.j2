{
  "embeds": [
    {
      "title": "⬆️ Jellyfin Library Upgrades ({{ total_items }})",
      "description": "The following items have been upgraded in Jellyfin:",
      "color": 16766720,
      "fields": [
        {% if 'movies' in categories and categories.movies.upgraded|length > 0 %}
        {
          "name": "🎬 Movies Upgraded ({{ categories.movies.upgraded|length }})",
          "value": "{% for item_data in categories.movies.upgraded[:8] %}**{{ item_data.item.name }}**{% if item_data.item.year %} ({{ item_data.item.year }}){% endif %}\n📐 {{ item_data.item.video_height or 'Unknown' }}p{% if item_data.item.video_range and item_data.item.video_range != 'SDR' %} {{ item_data.item.video_range }}{% endif %}{% if item_data.item.video_codec %} • 🎞️ {{ item_data.item.video_codec.upper() }}{% endif %}{% if item_data.item.audio_codec %} • 🔊 {{ item_data.item.audio_codec.upper() }}{% if item_data.item.audio_channels %} {{ item_data.item.audio_channels }}.{% if item_data.item.audio_channels > 2 %}1{% else %}0{% endif %}{% endif %}{% endif %}{% if item_data.changes|length > 0 %}\n**Changes**: {% for change in item_data.changes[:2] %}{% if change.type == 'resolution' %}{{ change.old_value or 'Unknown' }}p→**{{ change.new_value or 'Unknown' }}p**{% elif change.type == 'codec' %}{{ change.old_value or 'Unknown' }}→**{{ change.new_value or 'Unknown' }}**{% elif change.type == 'audio_codec' %}Audio: {{ change.old_value or 'Unknown' }}→**{{ change.new_value or 'Unknown' }}**{% elif change.type == 'audio_channels' %}{{ change.old_value or 0 }}ch→**{{ change.new_value or 0 }}ch**{% elif change.type == 'hdr_status' %}{{ change.old_value or 'SDR' }}→**{{ change.new_value or 'SDR' }}**{% else %}{{ change.description }}{% endif %}{% if not loop.last %} • {% endif %}{% endfor %}{% if item_data.changes|length > 2 %} +{{ item_data.changes|length - 2 }} more{% endif %}{% endif %}{% if not loop.last %}\n\n{% endif %}{% endfor %}{% if categories.movies.upgraded|length > 8 %}\n...and {{ categories.movies.upgraded|length - 8 }} more movies were upgraded.{% endif %}",
          "inline": false
        }{% if ('tv' in categories and categories.tv.upgraded|length > 0) or ('music' in categories and categories.music.upgraded|length > 0) or ('other' in categories and categories.other.upgraded|length > 0) %},{% endif %}
        {% endif %}
        {% if 'tv' in categories and categories.tv.upgraded|length > 0 %}
        {
          "name": "📺 TV Episodes Upgraded ({{ categories.tv.upgraded|length }})",
          "value": "{% for item_data in categories.tv.upgraded[:8] %}**{{ item_data.item.series_name }}** S{{ '%02d'|format(item_data.item.season_number or 0) }}E{{ '%02d'|format(item_data.item.episode_number or 0) }} - {{ item_data.item.name }}\n📐 {{ item_data.item.video_height or 'Unknown' }}p{% if item_data.item.video_range and item_data.item.video_range != 'SDR' %} {{ item_data.item.video_range }}{% endif %}{% if item_data.item.video_codec %} • 🎞️ {{ item_data.item.video_codec.upper() }}{% endif %}{% if item_data.item.audio_codec %} • 🔊 {{ item_data.item.audio_codec.upper() }}{% if item_data.item.audio_channels %} {{ item_data.item.audio_channels }}.{% if item_data.item.audio_channels > 2 %}1{% else %}0{% endif %}{% endif %}{% endif %}{% if item_data.changes|length > 0 %}\n**Changes**: {% for change in item_data.changes[:2] %}{% if change.type == 'resolution' %}{{ change.old_value or 'Unknown' }}p→**{{ change.new_value or 'Unknown' }}p**{% elif change.type == 'codec' %}{{ change.old_value or 'Unknown' }}→**{{ change.new_value or 'Unknown' }}**{% elif change.type == 'audio_codec' %}Audio: {{ change.old_value or 'Unknown' }}→**{{ change.new_value or 'Unknown' }}**{% elif change.type == 'audio_channels' %}{{ change.old_value or 0 }}ch→**{{ change.new_value or 0 }}ch**{% elif change.type == 'hdr_status' %}{{ change.old_value or 'SDR' }}→**{{ change.new_value or 'SDR' }}**{% else %}{{ change.description }}{% endif %}{% if not loop.last %} • {% endif %}{% endfor %}{% if item_data.changes|length > 2 %} +{{ item_data.changes|length - 2 }} more{% endif %}{% endif %}{% if not loop.last %}\n\n{% endif %}{% endfor %}{% if categories.tv.upgraded|length > 8 %}\n...and {{ categories.tv.upgraded|length - 8 }} more episodes were upgraded.{% endif %}",
          "inline": false
        }{% if ('music' in categories and categories.music.upgraded|length > 0) or ('other' in categories and categories.other.upgraded|length > 0) %},{% endif %}
        {% endif %}
        {% if 'music' in categories and categories.music.upgraded|length > 0 %}
        {
          "name": "🎵 Music Upgraded ({{ categories.music.upgraded|length }})",
          "value": "{% for item_data in categories.music.upgraded[:10] %}**{{ item_data.item.name }}**{% if item_data.item.album %} • {{ item_data.item.album }}{% endif %}\n{% if item_data.item.artists and item_data.item.artists|length > 0 %}🎤 {{ item_data.item.artists[:2]|join(', ') }}{% if item_data.item.artists|length > 2 %} +{{ item_data.item.artists|length - 2 }} more{% endif %}\n{% endif %}🔊 {{ item_data.item.audio_codec.upper() or 'Unknown' }}{% if item_data.item.audio_channels %} {{ item_data.item.audio_channels }}.{% if item_data.item.audio_channels > 2 %}1{% else %}0{% endif %}{% endif %}{% if item_data.item.audio_bitrate %} • {{ (item_data.item.audio_bitrate / 1000)|int }} kbps{% endif %}{% if item_data.changes|length > 0 %}\n**Changes**: {% for change in item_data.changes %}{% if change.type == 'audio_codec' %}{{ change.old_value or 'Unknown' }}→**{{ change.new_value or 'Unknown' }}**{% elif change.type == 'audio_channels' %}{{ change.old_value or 0 }}ch→**{{ change.new_value or 0 }}ch**{% else %}{{ change.description }}{% endif %}{% if not loop.last %} • {% endif %}{% endfor %}{% endif %}{% if not loop.last %}\n\n{% endif %}{% endfor %}{% if categories.music.upgraded|length > 10 %}\n...and {{ categories.music.upgraded|length - 10 }} more tracks were upgraded.{% endif %}",
          "inline": false
        }{% if 'other' in categories and categories.other.upgraded|length > 0 %},{% endif %}
        {% endif %}
        {% if 'other' in categories and categories.other.upgraded|length > 0 %}
        {
          "name": "📁 Other Content Upgraded ({{ categories.other.upgraded|length }})",
          "value": "{% for item_data in categories.other.upgraded[:8] %}**{{ item_data.item.name }}** ({{ item_data.item.item_type }})\n{% if item_data.item.video_height %}📐 {{ item_data.item.video_height }}p{% if item_data.item.video_codec %} • 🎞️ {{ item_data.item.video_codec.upper() }}{% endif %}{% if item_data.item.audio_codec %} • 🔊 {{ item_data.item.audio_codec.upper() }}{% endif %}{% endif %}{% if item_data.changes|length > 0 %}\n**Changes**: {% for change in item_data.changes[:2] %}{% if change.type == 'resolution' %}{{ change.old_value or 'Unknown' }}p→**{{ change.new_value or 'Unknown' }}p**{% elif change.type == 'codec' %}{{ change.old_value or 'Unknown' }}→**{{ change.new_value or 'Unknown' }}**{% else %}{{ change.description }}{% endif %}{% if not loop.last %} • {% endif %}{% endfor %}{% if item_data.changes|length > 2 %} +{{ item_data.changes|length - 2 }} more{% endif %}{% endif %}{% if not loop.last %}\n\n{% endif %}{% endfor %}{% if categories.other.upgraded|length > 8 %}\n...and {{ categories.other.upgraded|length - 8 }} more items were upgraded.{% endif %}",
          "inline": false
        }
        {% endif %}
      ]{% set first_movie = categories.movies.upgraded|first if 'movies' in categories and categories.movies.upgraded|length > 0 else none %}{% set first_series_or_episode = categories.tv.upgraded|selectattr('item.item_type', 'equalto', 'Series')|first if 'tv' in categories and categories.tv.upgraded|length > 0 else categories.tv.upgraded|first if 'tv' in categories and categories.tv.upgraded|length > 0 else none %}{% set first_music = categories.music.upgraded|first if 'music' in categories and categories.music.upgraded|length > 0 else none %}{% set first_other = categories.other.upgraded|first if 'other' in categories and categories.other.upgraded|length > 0 else none %}{% if first_movie or first_series_or_episode or first_music or first_other %},
      "thumbnail": {
        "url": "{% if first_movie %}{{ jellyfin_url }}/Items/{{ first_movie.item.item_id }}/Images/Primary?api_key={{ api_key }}&maxHeight=400&maxWidth=300{% elif first_series_or_episode and first_series_or_episode.item.item_type == 'Series' %}{{ jellyfin_url }}/Items/{{ first_series_or_episode.item.item_id }}/Images/Primary?api_key={{ api_key }}&maxHeight=400&maxWidth=300{% elif first_series_or_episode and first_series_or_episode.item.series_id %}{{ jellyfin_url }}/Items/{{ first_series_or_episode.item.series_id }}/Images/Primary?api_key={{ api_key }}&maxHeight=400&maxWidth=300{% elif first_music %}{{ jellyfin_url }}/Items/{{ first_music.item.item_id }}/Images/Primary?api_key={{ api_key }}&maxHeight=400&maxWidth=300{% elif first_other %}{{ jellyfin_url }}/Items/{{ first_other.item.item_id }}/Images/Primary?api_key={{ api_key }}&maxHeight=400&maxWidth=300{% else %}{{ jellyfin_url }}/web/assets/img/banner-light.png{% endif %}"
      }{% endif %}{% if first_movie %},
      "image": {
        "url": "{{ jellyfin_url }}/Items/{{ first_movie.item.item_id }}/Images/Primary?api_key={{ api_key }}&maxHeight=400&maxWidth=300"
      }{% elif first_series_or_episode and first_series_or_episode.item.item_type == 'Series' %},
      "image": {
        "url": "{{ jellyfin_url }}/Items/{{ first_series_or_episode.item.item_id }}/Images/Primary?api_key={{ api_key }}&maxHeight=400&maxWidth=300"
      }{% endif %},
      "footer": {
        "text": "Updated in Jellyfin • {{ timestamp[:19] | replace('T', ' ') }} UTC{% if tvdb_attribution_needed %}\nMetadata provided by TheTVDB{% endif %}",
        "icon_url": "{{ jellyfin_url }}/web/favicon.ico"
      },
      "timestamp": "{{ timestamp }}"
    }
  ]
}